jQuery.cookie=function(b,l,o){if(typeof l!="undefined"){o=o||{};if(l===null){l="";o.expires=-1}var f="";if(o.expires&&(typeof o.expires=="number"||o.expires.toUTCString)){var g;if(typeof o.expires=="number"){g=new Date();g.setTime(g.getTime()+(o.expires*24*60*60*1000))}else{g=o.expires}f="; expires="+g.toUTCString()}var n=o.path?"; path="+o.path:"";var h=o.domain?"; domain="+o.domain:"";var a=o.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(l),f,n,h,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var m=document.cookie.split(";");for(var j=0;j<m.length;j++){var c=jQuery.trim(m[j]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};if(!dbank){var dbank={}}if(!dbank.config){dbank.config={}}(function(){dbank.config.cache={expireStatic:30*60*1000,cacheStatic:true,typeStatic:"html5/userdata",expireDynamic:5*60*1000,cacheDynamic:true,typeDynamic:"flash",flashDomain:"www.dbank.com,dl.dbank.com,s.dbank.com,login.dbank.com,api.dbank.com,st1.dbank.com,st2.dbank.com,st3.dbank.com,open.dbank.com,vip.dbank.com",getInfo:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getAccounts:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getbalance:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getBindingStatusSina:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getBindingStatusQqspace:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getIssign:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},getCountunread:{cache:true,expire:5*60*1000,type:"flash",sharedobject:"dbank",tag:"dynamic"},recEditor:{cache:true,expire:30*60*1000,type:"html5/userdata",tag:"static"},recExtlink:{cache:true,expire:30*60*1000,type:"html5/userdata",tag:"static"},recWeibolink:{cache:true,expire:30*60*1000,type:"html5/userdata",tag:"static"},recSecurelink:{cache:true,expire:30*60*1000,type:"html5/userdata",tag:"static"},client:{cache:true,expire:0,type:"flash",sharedobject:"common"},secretFlash:{cache:true,expire:0,type:"flash",sharedobject:"common"},secretNotflash:{cache:true,expire:0,type:"html5/userdata"},banner:{cache:true,expire:30*60*1000,type:"flash",sharedobject:"banner"}}})();Rookie.get_browser=function(){var a=navigator.userAgent.toLowerCase();if(window.ActiveXObject){return"ie"}if(/firefox/i.test(a)){return"firefox"}if(/chrome/i.test(a)&&/webkit/i.test(a)&&/mozilla/i.test(a)){return"chrome"}if(window.opera){return"opera"}if(window.openDatabase){return"safari"}return"other"};Rookie.getSWF=function(a){if(window.document[a]){return window.document[a]}else{return document.getElementById(a)}};Rookie.swfReady=function(){Rookie.asToJs=true};Rookie.cross=function(){return Rookie.crossDomain};Rookie.policy=function(){return dbank.config.cache.flashDomain};function Rookie(c,d){var b=1;var a=1;(function(){a++;if(Rookie.local=Rookie.getSWF("rookieswf")){(function(){b++;if(Rookie.asToJs){try{Rookie.local.available=Rookie.local.callAS();c.call(Rookie.local)}catch(f){try{if(d){d.call()}}catch(f){}return}}else{if(b>150){try{if(d){d.call()}}catch(f){}return}if(b<=150){setTimeout(arguments.callee,20)}}})()}else{if(a>3&&d){d.call();return}if(a<=3){setTimeout(arguments.callee,20)}}})()}(function(){var c="http://www.dbank.com/netdisk/components/localStorage/rookie.swf";if((/http:\/\//i).test(c)&&c.indexOf(window.location.host)==-1){Rookie.crossDomain=true}if(Rookie.get_browser()=="ie"){c+="?"+Math.floor(Math.random()*100000)}var b='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="1" height="1" id="rookieswf"><param name="movie" value="'+c+'" /><param name="allowScriptAccess" value="always" /><embed src="'+c+'" width="1" height="1" name="rookieswf" allowScriptAccess="always" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object>';var a=document.createElement("div");a.style.width="1px";a.style.height="0";a.style.overflow="hidden";(function(){if(document.body){var d=document.title;a.innerHTML=b;document.body.insertBefore(a,document.body.firstChild);document.title=d}else{setTimeout(arguments.callee,15)}})()})();if(!dbank){var dbank={}}if(!dbank.cache){dbank.cache={}}(function(){var c=dbank.config.cache.expireDynamic;var b=dbank.config.cache.expireStatic;var a={html5put:function(h,l,g){try{var j=dbank.json.jsonToString(l);var f=null;localStorage.setItem(h,j);if(g){f=g}else{f=b}var d=h+".expire";var n=((new Date()).getTime())+f;localStorage.setItem(d,n);return true}catch(m){}},html5get:function(h){try{var d=null;var f;f=localStorage.getItem(h+".expire");var g=(new Date()).getTime();if(g<f||f==0){d=localStorage.getItem(h)}else{localStorage.removeItem(h);localStorage.removeItem(h+".expire")}return d}catch(j){}},html5remove:function(d){try{localStorage.removeItem(d);localStorage.removeItem(d+".expire");return true}catch(f){}},html5clear:function(){try{}catch(d){}},userdataput:function(h,l,d){try{var g=Math.floor(Math.random()*9+1);var j=dbank.json.jsonToString(l);userdataObj=document.createElement("input");userdataObj.type="hidden";userdataObj.addBehavior("#default#userData");document.body.appendChild(userdataObj);userdataObj.load(g);userdataObj.setAttribute(h,j);if(d!=0){if(d){expires=d}else{expires=b}var f=(new Date()).getTime();var n=f+expires;userdataObj.expires=(new Date(n)).toUTCString()}userdataObj.save(g);userdataObj.load("filename");userdataObj.setAttribute(h,g);userdataObj.save("filename")}catch(m){}},userdataget:function(g){try{var d=null;userdataObj=document.createElement("input");userdataObj.type="hidden";userdataObj.addBehavior("#default#userData");document.body.appendChild(userdataObj);userdataObj.load("filename");var f=userdataObj.getAttribute(g);userdataObj.load(f);d=userdataObj.getAttribute(g);return d}catch(h){}},userdataremove:function(f){try{userdataObj=document.createElement("input");userdataObj.type="hidden";userdataObj.addBehavior("#default#userData");document.body.appendChild(userdataObj);userdataObj.load("filename");var d=userdataObj.getAttribute(f);userdataObj.removeAttribute(f);userdataObj.save("filename");userdataObj.load(d);userdataObj.removeAttribute(f);userdataObj.save(d)}catch(g){}},userdataclear:function(d){try{}catch(f){}},flashput:function(g,h,f){try{Rookie(function(){this.write(g,h)});if(f){expires=f}else{expires=c}var d=g+".expire";var l=((new Date()).getTime())+expires;Rookie(function(){this.write(d,l)});return true}catch(j){}},flashputcommon:function(g,h,f,m){try{Rookie(function(){this.writeCommon(m,g,h)});var d=g+".expire";var l;if(f==0){l=0}else{if(f){expires=f}else{expires=c}l=((new Date()).getTime())+expires}Rookie(function(){this.writeCommon(m,d,l)});return true}catch(j){}},flashget:function(g){try{var d=null;var f=null;Rookie(function(){f=this.read(g+".expire");var j=(new Date()).getTime();if(j<f){d=this.read(g)}else{this.write(g,null);this.write(g+".expire",null)}});return d}catch(h){}},flashgetcommon:function(g,j){try{var d=null;var f=null;Rookie(function(){f=this.readCommon(j,g+".expire");var l=(new Date()).getTime();if(l<f||f==0){d=this.readCommon(j,g)}else{this.writeCommon(j,g,null);this.writeCommon(j,g+".expire",null)}});return d}catch(h){}},flashremove:function(d){try{Rookie(function(){this.write(d,null);this.write(d+".expire",null)});return true}catch(f){}},flashremovecommon:function(d,g){try{Rookie(function(){this.writeCommon(g,d,null);this.writeCommon(g,d+".expire",null)});return true}catch(f){}},flashclear:function(){try{Rookie(function(){this.clear()});return true}catch(d){}},flashclearcommon:function(f){try{Rookie(function(){this.clearCommon(f)});return true}catch(d){}},xdrPut:function(f,j,d,h){try{var g={param:{action:"set",key:f,value:j,expire:d},method:"cache"};var m=function(n){alert(n)};dbank.io.xdr.send(g,m,h)}catch(l){}},xdrGet:function(d,g){try{var f={param:{action:"get",key:d},method:"cache"};var j=function(l){alert(l);return l};dbank.io.xdr.send(f,j,g)}catch(h){}},xdrRemove:function(d,g){try{var f={param:{action:"remove",key:d},method:"cache"};var j=function(l){alert(l)};dbank.io.xdr.send(f,j,g)}catch(h){}}};dbank.cache=a})();if(!nsp){var nsp={}}if(!nsp.netdisk){nsp.netdisk={}}(function(){nsp.netdisk.url="http://api.dbank.com/rest.php";var path_id_map={};var __Cache__={};var __RootId__;var path_name_regex=/(^.*)\/([^\/]*$)/;var cache_get=function(pid,type){var ret=__Cache__[pid];if(!pid){ret=__Cache__[__RootId__]}if(typeof ret!="undefined"&&(parseInt(ret.fileCount)==0&&parseInt(ret.dirCount)==0||parseInt(ret.fileCount)+parseInt(ret.dirCount)==ret.childList.length||type==1&&ret.childList[0].type=="File"||type==2&&ret.childList[0].type=="Directory")){return ret}};var cache_put=function(tree){if(typeof tree==="array"){for(var i=0;i<tree.length;i++){cache_put(tree[i])}}else{if(tree&&tree.type=="Directory"&&(tree.childList||(parseInt(tree.fileCount)==0&&parseInt(tree.dirCount)==0))){__Cache__[tree.id]=tree;if(tree.pid=="d.0"&&tree.dbank_systemType==3){__RootId__=tree.id}if(tree.childList){for(var i=0;i<tree.childList.length;i++){cache_put(tree.childList[i])}}}}};var nsp_invoke=function(data,onsuccess,onerror){if($.cookie("session")){if($.cookie("secret")){$.buildData(data)}else{Rookie(function(){$.buildData(data)},function(){$.buildData(data)})}if($.param(data).length>=2000){var params={url:nsp.netdisk.url,method:"post",params:data};if($.fn.jquery=="1.3.2"){params=reparam(params)}var parseToJSON=function(data,callback){if(data&&typeof data=="string"){if(data.match(/^_jqjsp/)=="_jqjsp"&&data.length>7){data=data.substring(7,data.length-1);if($.fn.jquery=="1.3.2"){data=reparseJSON($.trim(data))}else{data=$.parseJSON($.trim(data))}if(typeof data=="object"&&callback){callback(data)}else{if(typeof data=="string"&&callback){callback(data)}else{if(typeof data=="boolean"&&callback){callback(data)}else{callback({error:"fail"})}}}}else{if($.fn.jquery=="1.3.2"){data=reparseJSON($.trim(data))}else{data=$.parseJSON($.trim(data))}if(typeof data=="object"&&callback){callback(data)}else{if(typeof data=="string"&&callback){callback(data)}else{if(typeof data=="boolean"&&callback){callback(data)}else{callback({error:"fail"})}}}}}else{if(data&&typeof data=="object"){callback(data)}else{callback({error:"fail"})}}};var currentHost=location.host;jQuery.ajax({type:"post",url:"http://"+currentHost+"/app/web/cross_request.php",data:params,dataType:"text",timeout:30000,success:function(data){parseToJSON(data,onsuccess)},pageCache:true,error:function(data){parseToJSON(data,onerror)}})}else{var svc=data.nsp_svc;var type=data.type;var cache;var right;cache=checkCacheStatus(svc,type);if(cache){Rookie(function(){if(type){var cacheData=getCache(svc,type)}else{var cacheData=getCache(svc)}if(cacheData!=null){onsuccess(cacheData)}else{$.jsonp({url:nsp.netdisk.url,data:data,dataType:"jsonp",callbackParameter:"nsp_cb",timeout:30000,success:function(data){if(data.NSP_STATUS>0&&data.NSP_STATUS<=109){try{if(typeof dbank.util.login_timeout_fun=="function"){var isstop=dbank.util.login_timeout_fun();if(isstop){onerror(data);return false}}dbank.util.login({success:function(){}})}catch(e){}}else{if(type){putCache(data,svc,type)}else{putCache(data,svc)}onsuccess(data)}},pageCache:true,error:onerror})}},function(){$.jsonp({url:nsp.netdisk.url,data:data,dataType:"jsonp",callbackParameter:"nsp_cb",timeout:30000,success:function(data){if(data.NSP_STATUS>0&&data.NSP_STATUS<=109){try{if(typeof dbank.util.login_timeout_fun=="function"){var isstop=dbank.util.login_timeout_fun();if(isstop){onerror(data);return false}}dbank.util.login({success:function(){}})}catch(e){}}else{onsuccess(data)}},pageCache:true,error:onerror})})}else{$.jsonp({url:nsp.netdisk.url,data:data,dataType:"jsonp",callbackParameter:"nsp_cb",timeout:30000,success:function(data){if(data.NSP_STATUS>0&&data.NSP_STATUS<=109){try{if(typeof dbank.util.login_timeout_fun=="function"){var isstop=dbank.util.login_timeout_fun();if(isstop){onerror(data);return false}}$("#mashead .userguide").show();$("#hd .hd_nav").show();dbank.util.login({success:function(){}})}catch(e){}}else{onsuccess(data)}},pageCache:true,error:onerror})}}}else{try{if(typeof dbank.util.login_timeout_fun=="function"){var isstop=dbank.util.login_timeout_fun();if(isstop){onerror(data);return false}}dbank.util.login({success:function(){}})}catch(e){}}};var user_info;var disk_info;var user_info_requests=[];var userinfo=function(o){if(typeof user_info!="undefined"&&!o.nocache){o.success(user_info);return}var param={nsp_svc:"nsp.user.getInfo",attrs:'["profile.link_access_switch","profile.dlink_white_list","profile.dlink_switch","product.fileuploadsize","user.status","user.username","user.email","user.uid","product.spacecapacity", "profile.spaceextcapacity", "profile.usedspacecapacity","profile.orderenddate", "profile.productid", "profile.extra_apps", "product.productname","profile.dbank_skin","profile.dbank_avatar_type","profile.dbank_avatar","profile.paycapacity","profile.interval","profile.last_login_ip","profile.dbank_outlink","profile.dbank_netdisk","profile.dbank_outlink_file","profile.login_setter_status","product.linkfilesize","product.package","product.medal","profile.card_type","plugin.dl","plugin.netdisk","product.tryvip68","product.tryvip990","profile.pwd_switch","profile.direct_switch","user.signin_vip"]'};user_info_requests.push(o);if(user_info_requests.length>0){var success=function(data){user_info={totalSpace:parseFloat(data["product.spacecapacity"])+parseFloat(data["profile.spaceextcapacity"]),useredSpace:data["profile.usedspacecapacity"],productId:data["profile.productid"],productname:data["product.productname"],userName:data["user.username"],orderenddate:data["profile.orderenddate"],email:data["user.email"],extra_apps:data["profile.extra_apps"],dbank_skin:data["profile.dbank_skin"],dbank_avatar_type:data["profile.dbank_avatar_type"],fileuploadsize:data["product.fileuploadsize"],dbank_avatar:data["profile.dbank_avatar"],uid:data["user.uid"],rankSpace:data["product.spacecapacity"],paycapacity:data["profile.paycapacity"],interval:data["profile.interval"],linkfilesize:data["product.linkfilesize"],dlink_switch:data["profile.dlink_switch"],dlink_white_list:data["profile.dlink_white_list"],productpackage:data["product.package"],link_access_switch:data["profile.link_access_switch"],medal:data["product.medal"],card_type:data["profile.card_type"],plugindl:data["plugin.dl"],pluginnetdisk:data["plugin.netdisk"],tryvip68:data["product.tryvip68"],tryvip990:data["product.tryvip990"],pwd_switch:data["profile.pwd_switch"],direct_switch:data["profile.direct_switch"],signin_vip:data["user.signin_vip"]};o.success(user_info)};var error=function(errno,error){if(typeof o.error==="function"){o.error(errno,error)}};return nsp_invoke(param,success,error)}};var diskinfo=function(o){if(typeof o.nocache==="undefined"){o.nocache=true}return userinfo(o)};var lsdir=function(o){var addId=function(data,parentPath,pid){if($.isArray(data)){for(var i=0;i<data.length;i++){first=false;addId(data[i],parentPath,pid)}}else{if(data){if(pid){data.pid=pid}if(parentPath){data.path=parentPath}else{data.path="/";data.id="d.0"}if(data.name){if(data.path=="/"){data.path+=data.name}else{data.path+="/"+data.name}data.id=$.md5(data.path);if(data.dbank_srcpath){data.dbank_srcpath_display=data.dbank_srcpath.replace(/^\/Netdisk/,"/我的网盘").replace(/^\/Syncbox/,"/爱同步")}if(data.pid=="d.0"){if(data.dbank_systemType==3){data.name="我的网盘"}else{if(data.dbank_systemType==901){data.name="我的pc文件夹"}else{if(data.dbank_systemType==5){data.name="回收站"}}}}path_id_map[data.id]={path:data.path,pid:data.pid,name:data.name}}if(data.childList){addId(data.childList,data.path,data.id)}}}};var param={nsp_svc:"nsp.vfs.lsdir"};if(!o.path&&(!o.pid||o.pid=="d.0")){$.extend(param,{recursive:2})}if(o.pid){param.path=path_of(o.pid)}if(o.path){param.path=o.path}param.fields="[";if(o.fields&&$.isArray(o.fields)){$.each(o.fields,function(i,d){param.fields+='"'+d+'",'})}param.fields+='"name","size","type","dirCount","fileCount","dbank_systemType","dbank_isShared","modifyTime","dbank_status","dbank_srcpath","dbank_srcname","accessTime","url"]';if(o.type){param.type=o.type}if(o.recursive){param.recursive=o.recursive}var success=function(data){if(data.error){o.error(10055,data.error);return}if(o.pid){data.id=o.pid}data.type="Directory";addId(data,param.path);if(path_id_map[o.pid]){data.pid=path_id_map[o.pid].pid;data.name=path_id_map[o.pid].name}if(!o.path&&(!o.pid||o.pid=="d.0")){o.success(data.childList)}else{var attr_param={files:'["'+param.path+'"]',fields:'["dirCount","fileCount","dbank_isShared","dbank_systemType"]',success:function(attdata){if(attdata.successList&&attdata.successList.length){data.dirCount=attdata.successList[0].dirCount;data.fileCount=attdata.successList[0].fileCount;data.dbank_isShared=attdata.successList[0].dbank_isShared;data.dbank_systemType=attdata.successList[0].dbank_systemType}o.success(data)},error:o.error};nsp.netdisk.getFileInfo(attr_param)}};return nsp_invoke(param,success,o.error)};var mbStringLength=function(s){var totalLength=0;var i;var charCode;for(i=0;i<s.length;i++){charCode=s.charCodeAt(i);if(charCode<127){totalLength=totalLength+1}else{totalLength+=2}}return totalLength};var mkdir=function(o){if((!o.pid&&!o.path)||!o.name){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.mkfile"};if(o.path){param.path=o.path}else{if(o.pid){param.path=path_of(o.pid)}}if(mbStringLength(param.path)+mbStringLength(o.name)>199){o.error(10004,"path is too large");return}param.files='[{"name":"'+o.name+'","type":"Directory"}]';var success=function(data){if(data.successList.length){o.success(data)}else{if(data.failList.length){o.error(data.failList[0].errCode,data.failList[0].errMsg)}}};return nsp_invoke(param,success,o.error)};var check_name=function(name,files){files=files.toString().toLowerCase().split(",");while($.inArray(name.toLowerCase(),files)!=-1){name=addName(name)}return name};var mkfile=function(o){if(!o.files||(!o.pid&&!o.path)){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.mkfile"};if(o.path){param.path=o.path}else{param.path=path_of(o.pid)}var files=eval(o.files);var files_arry=[];var use_able_space=0;var success=function(data){var filenames=[];$.each(data.childList,function(){filenames.push(this.name)});$.each(files,function(){if(parseInt(this.size)>use_able_space){o.error(10072,"网盘可用空间不足");return}use_able_space-=parseInt(this.size);this.type="File";this.name=check_name(this.name,filenames);results=[];object=this;for(var property in object){var value=object[property];if(value!==undefined){results.push('"'+property+'":"'+value+'"')}}files_arry.push("{"+results.join(",")+"}")});param.files="["+files_arry.join(",")+"]";var mkfile_success=function(data){user_info=undefined;o.success(data)};return nsp_invoke(param,mkfile_success,o.error)};var disk_info_param={success:function(data){use_able_space=parseInt(data.totalSpace)-parseInt(data.useredSpace);var lsdir_param={path:param.path,type:3,nsp_svc:"nsp.vfs.lsdir"};return nsp_invoke(lsdir_param,success)},error:o.error};return diskinfo(disk_info_param)};var rename=function(o){if(!o.name){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.movefile"};var path;if(o.path){path=o.path}else{path=path_of(o.id)}var pid=$.md5(path.match(path_name_regex)[1]);param.files='["'+path+'"]';path=path.match(path_name_regex)[1]+"/"+o.name;param.path=path;path_id_map[$.md5(path)]={path:path,name:o.name,pid:pid};var success=function(data){if(data.successList.length){$.each(data.successList,function(){this.oid=o.id;this.id=$.md5(path)});o.success(data)}else{if(data.failList.length){o.error(data.failList[0].errCode,data.failList[0].errMsg)}}};return nsp_invoke(param,success,o.error)};var isRecycle=function(files_str){var files=eval(files_str);var a=false;$.each(files,function(){if(this.substring(0,8)=="/Recycle"){a=true}});return a};var rmfile=function(o){if(!o.files){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.rmfile",reserve:true};var special_char_files=[];var temp=[];var rm_files=param.files=str_to_array_files(o.files,temp);$.each(eval(rm_files),function(){var fname=this.match(path_name_regex)[2];if(fname.match(/[<>:"\/\\|\?\*]+/g)){special_char_files.push(fname)}});if(special_char_files.length>0){o.error(11111,"您要删除的文件含有特殊字符，请重命名后再作操作");return}var success=function(data){if(data.successList){user_info=undefined;$.each(data.successList,function(){this.id=temp[this.name]})}if(data.failList){$.each(data.failList,function(){this.id=temp[this.name]})}o.success(data)};if(isRecycle(param.files)){param.reserve=0}var error=function(er,no,op){o.error(er,no,op)};return nsp_invoke(param,success,error)};var clear_recycle=function(o){user_info=undefined;nsp_invoke({nsp_svc:"nsp.vfs.trash"},o.success,o.error)};var createResTemplate=function(o){var param=o.param||{};param.nsp_svc="nsp.vfs.link.createResTemplate";nsp_invoke(param,o.success,o.error)};var getResTemplate=function(o){var param=o.param||{};param.nsp_svc="nsp.vfs.link.getResTemplate";nsp_invoke(param,o.success,o.error)};var create_link=function(o){if(!o.files||!o.title){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.link.create",title:o.title};if(o.summary){param.summary=o.summary}if(o.tags){param.tags=o.tags}if(o.content){param.content=o.content}if(o.form){param.form=o.form}if(o.attrs){param.attrs=o.attrs}param.files=str_to_array_files(o.files);return nsp_invoke(param,o.success,o.error)};var str_to_array_relative_files=function(files_str,idmap){var ids=[];if(!$.isArray(files_str)){files_str=eval(files_str)}$.each(files_str,function(){ids.push('"'+path_of(this.id).match(/[^\/]+$/)+'"');if(idmap){idmap[path_of(this.id)+""]=this.id}});return"["+ids.join(",")+"]"};var str_to_array_files=function(files_str,idmap){var ids=[];if(!$.isArray(files_str)){files_str=eval(files_str)}$.each(files_str,function(){ids.push('"'+path_of(this.id)+'"');if(idmap){idmap[path_of(this.id)+""]=this.id}});return"["+ids.join(",")+"]"};var str_to_setattr_files=function(files_str,attr,idmap){var ids=[];if(!$.isArray(files_str)){files_str=eval(files_str)}$.each(files_str,function(){ids.push('"'+path_of(this.id)+'":'+attr);if(idmap){idmap[path_of(this.id)+""]=this.id}});return"{"+ids.join(",")+"}"};var setattr_files=function(files_str,attr){var attrs=[];if(!$.isArray(files_str)){files_str=eval(files_str)}$.each(files_str,function(){attrs.push('"'+this+'":'+attr)});return"{"+attrs.join(",")+"}"};var movefile=function(o,restore){return file_operate(o,"nsp.vfs.movefile",restore)};var copyfile=function(o){return file_operate(o,"nsp.vfs.copyfile")};var file_operate=function(o,operate,restore){if(!o.files||(!o.pid&&!o.path)){o.error(1001,"parameter invalid");return}var param={nsp_svc:operate};var temp=[];var move_files;var same_name_files=[];var recycle_files=[];var restore_files=[];param.files=[];if(o.path){param.path=o.path;move_files=eval(o.files,temp)}else{move_files=eval(str_to_array_files(o.files,temp));param.path=path_of(o.pid)}var success=function(data){var filenames=[];var ofilenames=[];var has_special_char=false;$.each(data.childList,function(){filenames.push(this.name);ofilenames.push(this.name.toLowerCase())});$.each(move_files,function(){var fname=this.match(path_name_regex)[2];if(fname.match(/[<>:"\/\\|\?\*]+/g)){has_special_char=true}if(restore){restore_files.push(this)}else{if(this.substring(0,8)=="/Recycle"){recycle_files.push(this)}else{if($.inArray(fname.toLowerCase(),ofilenames)==-1){param.files.push('"'+this+'"');filenames.push(fname)}else{same_name_files.push(this)}}}});if(has_special_char){o.error(11111,"文件名称含有特殊字符！");return}var move_success=function(data){if(typeof data.NSP_STATUS!="undefined"){o.error(data.NSP_STATUS,data.error);return}if(data.successList){user_info=undefined;$.each(data.successList,function(){this.id=temp[this.name];if(!this.id){this.id=$.md5(this.name)}})}if(data.failList){$.each(data.failList,function(){this.id=temp[this.name];if(!this.id){this.id=$.md5(this.name)}})}o.success(data)};if(param.files.length){param.files="["+param.files.join(",")+"]";nsp_invoke(param,move_success,o.error)}if(same_name_files.length){var parent_path=param.path;$.each(same_name_files,function(){var fname=check_name(this.match(path_name_regex)[2],filenames);filenames.push(fname);param.path=parent_path+"/"+fname;param.files='["'+this+'"]';nsp_invoke(param,move_success,o.error)})}if(restore_files.length){var parent_path=param.path;$.each(restore_files,function(){var fname=check_name(restore,filenames);filenames.push(fname);param.path=parent_path+"/"+fname;param.files='["'+this+'"]';nsp_invoke(param,move_success,o.error)})}if(recycle_files.length){var parent_path=param.path;var obj={files:'["'+recycle_files.join('","')+'"]',fields:'["dbank_srcname"]'};if(o.error){obj.error=o.error}obj.success=function(attr){$.each(attr.successList,function(){var fname=check_name(this.dbank_srcname,filenames);filenames.push(fname);param.path=parent_path+"/"+fname;param.files='["'+this.name+'"]';nsp_invoke(param,move_success,o.error)})};var setattr={files:setattr_files(recycle_files,'{"dbank_status":"0"}'),success:function(data){nsp.netdisk.getFileInfo(obj)},error:o.error};nsp.netdisk.getFileInfo(obj)}};var lsdir_param={path:param.path,type:3,nsp_svc:"nsp.vfs.lsdir"};if(operate=="nsp.vfs.copyfile"){var disk_info_param={success:function(data){var use_able_space=parseInt(data.totalSpace)-parseInt(data.useredSpace);var getsize={files:str_to_array_files(o.files),fields:'["size","space"]'};if(o.error){getsize.error=o.error}getsize.success=function(attr){$.each(attr.successList,function(){if(this.size){use_able_space-=this.size}if(this.space){use_able_space-=this.space}});if(use_able_space>=0){return nsp_invoke(lsdir_param,success)}else{o.error(10072,"网盘可用空间不足")}};return nsp.netdisk.getFileInfo(getsize)},error:o.error};return diskinfo(disk_info_param)}else{return nsp_invoke(lsdir_param,success)}};var addName=function(name){name=name.substring(name.lastIndexOf("/")+1);var extendName=name.match(/\.[^\.]+$/);if(extendName){name=name.replace(extendName,"")}var match=name.match(/\(\d*\)$/);if(match){var num=match[0].match(/\d+/g)[0];name=name.replace(/\(\d*\)$/,"("+(++num)+")")}else{name=name+"(1)"}if(extendName){name+=extendName}return name};var restorefile=function(o){var idtemp=[];var obj={files:str_to_array_files(o.files,idtemp),fields:'["dbank_srcpath","dbank_srcname"]'};if(o.error){obj.error=o.error}obj.success=function(attr){if(attr.successList.length){var result={successList:[]};var count=0;var att=attr.successList[count];if(this.dbank_srcpath!=""){var param={files:'["'+att.name+'"]',path:att.dbank_srcpath,success:function(data){if(data.failList.length>0){$.warning({message:"还原文件失败"});return}if(data.successList){var successFile=data.successList[0];if(param.rpid){successFile.oPid=param.rpid}else{successFile.oPid=$.md5(param.path)}successFile.pid=$.md5(param.path);result.successList.push(successFile)}if(++count<attr.successList.length){att=attr.successList[count];param.files='["'+att.name+'"]';param.path=att.dbank_srcpath;create_path(param.path,function(rpid){param.rpid=rpid;movefile(param,att.dbank_srcname)},o.error)}else{o.success(result)}},error:function(errno,errmsg){o.error(errno,errmsg)}};create_path(param.path,function(rpid){param.rpid=rpid;movefile(param,att.dbank_srcname)},o.error)}}};var setattr={files:str_to_setattr_files(o.files,'{"dbank_status":"0"}'),success:function(data){nsp.netdisk.getFileInfo(obj)},error:function(errno,errmsg){o.error(errno,errmsg)}};return nsp.netdisk.getFileInfo(obj)};nsp.netdisk.getFileInfo=function(o){if(!o.files){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.getattr"};if(o.fields){param.fields=o.fields}param.files=o.files;return nsp_invoke(param,o.success,o.error)};nsp.netdisk.setFileInfo=function(o){if(!o.files){o.error(1001,"parameter invalid");return}var param={nsp_svc:"nsp.vfs.setattr"};param.files=o.files;return nsp_invoke(param,o.success,o.error)};var create_path=function(path,success_callback,error_callback){var rpid="";var path_array=path.split("/");path_array=$.grep(path_array,function(n){return n!=""});path_array[0]="/"+path_array[0];for(var j=1;j<path_array.length;j++){path_array[j]=path_array[j-1]+"/"+path_array[j]}var path_array_param=[];var countnum=0;var i=0;for(;i<path_array.length;i++){path_array_param[i]=path_array[i];countnum+=path_array_param[i].length;if(countnum>1500){break}}var files='["'+path_array_param.join('","')+'"]';var oattr={files:files,success:function(data){if(data.failList&&data.failList.length){var index=0;var match=data.failList[index].name.match(path_name_regex);var omkdir={path:match[1],name:match[2],success:function(jsdata){index++;if(index<data.failList.length){match=data.failList[index].name.match(path_name_regex);omkdir.path=match[1];if(rpid==""){rpid=$.md5(omkdir.path.match(path_name_regex)[1])}omkdir.name=match[2];nsp.netdisk.mkdir(omkdir)}else{if(i==path_array.length){success_callback(rpid)}else{path_array_param=[];countnum=0;for(var k=0;i<path_array.length;i++){path_array_param[k]=path_array[i];countnum+=path_array_param[k++].length;if(countnum>1500){break}}oattr.files='["'+path_array_param.join('","')+'"]';nsp.netdisk.getFileInfo(oattr)}}}};nsp.netdisk.mkdir(omkdir)}else{if(i==path_array.length){success_callback(rpid)}else{path_array_param=[];countnum=0;for(k=0;i<path_array.length;i++){path_array_param[k]=path_array[i];countnum+=path_array_param[k++].length;if(countnum>1500){break}}oattr.files='["'+path_array_param.join('","')+'"]';nsp.netdisk.getFileInfo(oattr)}}},error:error_callback};nsp.netdisk.getFileInfo(oattr)};nsp.netdisk.getDownloadUrl=function(o){o.fields='["url"]';if(o.id){o.files='["'+path_of(o.id)+'"]'}var success=function(data){if(data.successList){o.success(data.successList[0].url)}else{o.error(1001,"parameter invalid")}};var param={nsp_svc:"nsp.vfs.getattr"};if(o.fields){param.fields=o.fields}param.files=o.files;return nsp_invoke(param,success,o.error)};nsp.netdisk.getFileContent=function(o){if(!o.id){o.error(1001,"parameter invalid");return}var param={action:"getFileContent",anticache:Math.floor(Math.random()*1000)};param.file='{"id":"'+o.id+'"}';if(o.uid){param.uid=o.uid}return nsp_invoke_old("get",param,o.success,o.error,"text")};nsp.netdisk.getUploadConfig=function(o){var param={nsp_svc:"nsp.user.getInfo",attrs:'["product.fileuploadsize","profile.productid","product.spacecapacity", "profile.spaceextcapacity", "profile.usedspacecapacity"]'};var success=function(data){data.fileuploadsize=data["product.fileuploadsize"];data.productId=data["profile.productid"];data.totalSpace=parseFloat(data["product.spacecapacity"])+parseFloat(data["profile.spaceextcapacity"]);data.useredSpace=data["profile.usedspacecapacity"];param={nsp_svc:"nsp.vfs.upauth"};success=function(upauth_data){data.nspSecret=upauth_data.secret;data.uploadRandomStr=upauth_data.nsp_tstr;data.nspAppid=upauth_data.nsp_tapp;data.nspVersion=upauth_data.nsp_tver;data.nspReqUrl=upauth_data.nsp_host;o.success(data)};nsp_invoke(param,success,o.error)};return nsp_invoke(param,success,o.error)};nsp.netdisk.mini_image=function(o){if((!o.id&&!o.files)||!o.width||!o.height){if(o.error){o.error(1001,"parameter invalid")}return}var success=function(data){if(data){var ss=[];$.each(data,function(name,url){ss.push({id:$.md5(name),url:url})});o.success(ss)}};var param={nsp_svc:"nsp.vfs.fpe.image.resize",width:o.width,height:o.height};if(o.files){param.files=o.files}if(o.pid){param.path=path_of(o.pid);if(!param.files){param.files=str_to_array_relative_files(o.id)}}else{if(!param.files){param.files=str_to_array_files(o.id)}}return nsp_invoke(param,success,o.error)};nsp.netdisk.netdisk_setting=function(o){var param={nsp_svc:"nsp.auth.update",account:o.account,key:o.key,attributes:o.attributes};return $.jsonp({url:nsp.netdisk.url,data:param,dataType:"jsonp",callbackParameter:"nsp_cb",timeout:30000,success:o.success,pageCache:true,error:o.error,data_post_process:o.data_post_process})};nsp.netdisk.netdisk_setterUserInfo=function(o){return nsp_invoke(o.param,o.success,o.error)};var path_of=function(id){return path_id_map[id]?path_id_map[id].path:"/"};var publishtoweibofuc=function(o){if(!o.param){if(o.error){o.error(1001,"parameter invalid")}return}if(o.param.files||o.param.id){if(o.param.files){o.param.files=o.param.files}else{o.param.files=str_to_array_files(o.param.id)}delete o.param.id}return nsp_invoke(o.param,function(data){o.success(data)},o.error)};var savelinkfiles=function(o){if(!o.param){if(o.error){o.error(1001,"parameter invalid")}return}return nsp_invoke(o.param,function(data){o.success(data)},o.error)};var getConfigInfo=function(key){try{var rt={};var expire=null;var cachetype=null;var tag=null;var soname=null;if(key=="www.dbank.com.rec.weibolink"){expire=dbank.config.cache.recWeibolink.expire;cachetype=dbank.config.cache.recWeibolink.type;tag=dbank.config.cache.recWeibolink.tag}else{if(key=="www.dbank.com.rec.securelink"){expire=dbank.config.cache.recSecurelink.expire;cachetype=dbank.config.cache.recSecurelink.type;tag=dbank.config.cache.recSecurelink.tag}else{if(key=="nsp.user.product.{"+$.cookie("session")+"}"||key=="nsp.user.user.{"+$.cookie("session")+"}"||key=="nsp.user.profile.{"+$.cookie("session")+"}"){expire=dbank.config.cache.getInfo.expire;cachetype=dbank.config.cache.getInfo.type;tag=dbank.config.cache.getInfo.tag}else{if(key=="nsp.user.account.{"+$.cookie("session")+"}"){expire=dbank.config.cache.getAccounts.expire;cachetype=dbank.config.cache.getAccounts.type;tag=dbank.config.cache.getAccounts.tag}else{if(key=="dbank.business.balance.{"+$.cookie("session")+"}"){expire=dbank.config.cache.getbalance.expire;cachetype=dbank.config.cache.getbalance.type;tag=dbank.config.cache.getbalance.tag}else{if(key=="app.weibo.bindingStatus.{"+$.cookie("session")+"}.sina"){expire=dbank.config.cache.getBindingStatusSina.expire;cachetype=dbank.config.cache.getBindingStatusSina.type;tag=dbank.config.cache.getBindingStatusSina.tag}else{if(key=="app.weibo.bindingStatus.{"+$.cookie("session")+"}.qqspace"){expire=dbank.config.cache.getBindingStatusQqspace.expire;cachetype=dbank.config.cache.getBindingStatusQqspace.type;tag=dbank.config.cache.getBindingStatusQqspace.tag}else{if(key=="www.dbank.com.rec.editor"){expire=dbank.config.cache.recEditor.expire;cachetype=dbank.config.cache.recEditor.type;tag=dbank.config.cache.recEditor.tag}else{if(key=="com.dbank.signin.issign.{"+$.cookie("session")+"}"){expire=dbank.config.cache.getIssign.expire;cachetype=dbank.config.cache.getIssign.type;tag=dbank.config.cache.getIssign.tag}else{if(key=="com.dbank.message.countunread.{"+$.cookie("session")+"}"){expire=dbank.config.cache.getCountunread.expire;cachetype=dbank.config.cache.getCountunread.type;tag=dbank.config.cache.getCountunread.tag}else{if(key=="client"){expire=dbank.config.cache.client.expire;cachetype=dbank.config.cache.client.type;soname=dbank.config.cache.client.sharedobject;tag=dbank.config.cache.client.tag}else{if(key=="secretFlash"){expire=dbank.config.cache.secretFlash.expire;cachetype=dbank.config.cache.secretFlash.type;soname=dbank.config.cache.secretFlash.sharedobject;tag=dbank.config.cache.secretFlash.tag}else{if(key=="secretNotflash"){expire=dbank.config.cache.secretNotflash.expire;cachetype=dbank.config.cache.secretNotflash.type;soname=dbank.config.cache.secretNotflash.sharedobject;tag=dbank.config.cache.secretNotflash.tag}else{if(key=="banner"){expire=dbank.config.cache.banner.expire;cachetype=dbank.config.cache.banner.type;soname=dbank.config.cache.banner.sharedobject}}}}}}}}}}}}}}if(expire==undefined){if(tag=="dynamic"){expire=dbank.config.cache.expireDynamic}if(tag=="static"){expire=dbank.config.cache.expireStatic}}if(cachetype==undefined){if(tag=="dynamic"){cachetype=dbank.config.cache.typeDynamic}if(tag=="static"){cachetype=dbank.config.cache.typeStatic}}rt.expire=expire;rt.cachetype=cachetype;rt.sharedobject=soname;return rt}catch(e){}};var put=function(key,value){try{var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){dbank.cache.flashput(key,value,configInfo.expire)}else{if(window.localStorage){dbank.cache.html5put(key,value,configInfo.expire)}else{dbank.cache.userdataput(key,value,configInfo.expire)}}}catch(e){}};var putcommon=function(objname,key,value){try{var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){dbank.cache.flashputcommon(key,value,configInfo.expire,objname)}else{if(window.localStorage){dbank.cache.html5put(key,value,configInfo.expire)}else{dbank.cache.userdataput(key,value,configInfo.expire)}}}catch(e){}};var get=function(key){try{var rt=null;var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){rt=dbank.cache.flashget(key)}else{if(window.localStorage){rt=dbank.cache.html5get(key)}else{rt=dbank.cache.userdataget(key)}}return rt}catch(e){}};var getcommon=function(objname,key){try{var rt=null;var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){rt=dbank.cache.flashgetcommon(key,objname)}else{if(window.localStorage){rt=dbank.cache.html5get(key)}else{rt=dbank.cache.userdataget(key)}}return rt}catch(e){}};var del=function(key){try{var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){dbank.cache.flashremove(key)}else{if(window.localStorage){dbank.cache.html5remove(key)}else{dbank.cache.userdataremove(key)}}}catch(e){}};var delcommon=function(objname,key){try{var configInfo=getConfigInfo(key);if(configInfo.cachetype=="flash"){dbank.cache.flashremovecommon(key,objname)}else{if(window.localStorage){dbank.cache.html5remove(key)}else{dbank.cache.userdataremove(key)}}}catch(e){}};var getCache=function(nsp_svc,type){try{var rt=null;switch(nsp_svc){case"nsp.user.getInfo":var key="nsp.user.user.{"+$.cookie("session")+"}";var userinfo=get(key);var key="nsp.user.product.{"+$.cookie("session")+"}";var productinfo=get(key);var key="nsp.user.profile.{"+$.cookie("session")+"}";var profileinfo=get(key);if(productinfo!=null&&userinfo!=null&&profileinfo!=null){var data={};var productinfoJson=productinfo;var userinfoJson=userinfo;var profileinfoJson=profileinfo;data["product.fileuploadsize"]=productinfoJson.fileuploadsize;data["product.spacecapacity"]=productinfoJson.spacecapacity;data["product.spaceextcapacity"]=productinfoJson.spaceextcapacity;data["product.productname"]=productinfoJson.productname;data["product.linkfilesize"]=productinfoJson.linkfilesize;data["product.package"]=productinfoJson["package"];data["product.tryvip68"]=productinfoJson.tryvip68;data["product.tryvip990"]=productinfoJson.tryvip990;data["product.medal"]=productinfoJson.medal;data["user.status"]=userinfoJson.status;data["user.username"]=userinfoJson.username;data["user.email"]=userinfoJson.email;data["user.uid"]=userinfoJson.uid;data["user.signin_vip"]=userinfoJson.signin_vip;data["profile.spaceextcapacity"]=profileinfoJson.spaceextcapacity;data["profile.usedspacecapacity"]=profileinfoJson.usedspacecapacity;data["profile.orderenddate"]=profileinfoJson.orderenddate;data["profile.productid"]=profileinfoJson.productid;data["profile.extra_apps"]=profileinfoJson.extra_apps;data["profile.dbank_skin"]=profileinfoJson.dbank_skin;data["profile.dbank_avatar_type"]=profileinfoJson.dbank_avatar_type;data["profile.dbank_avatar"]=profileinfoJson.dbank_avatar;data["profile.last_login_ip"]=profileinfoJson.last_login_ip;data["profile.dbank_outlink"]=profileinfoJson.dbank_outlink;data["profile.dbank_netdisk"]=profileinfoJson.dbank_netdisk;data["profile.dbank_outlink_file"]=profileinfoJson.dbank_outlink_file;data["profile.login_setter_status"]=profileinfoJson.login_setter_status;data["profile.paycapacity"]=profileinfoJson.paycapacity;data["profile.interval"]=profileinfoJson.interval;data["profile.card_type"]=profileinfoJson.card_type;data["profile.link_access_switch"]=profileinfoJson.link_access_switch;data["profile.dlink_white_list"]=profileinfoJson.dlink_white_list;data["profile.dlink_switch"]=profileinfoJson.dlink_switch;data["profile.pwd_switch"]=profileinfoJson.pwd_switch;data["profile.direct_switch"]=profileinfoJson.direct_switch;var pluginArr=[];if(profileinfoJson.plugindl){pluginArr=profileinfoJson.plugindl.split(",")}data["plugin.dl"]=pluginArr;pluginArr=[];if(profileinfoJson.pluginnetdisk){pluginArr=profileinfoJson.pluginnetdisk.split(",")}data["plugin.netdisk"]=pluginArr;rt=data}break;case"nsp.user.getAccounts":var key="nsp.user.account.{"+$.cookie("session")+"}";if(get(key)!=null){rt=[];rt[0]={account:get(key)}}else{rt=get(key)}break;case"com.dbank.business.getbalance":var key="dbank.business.balance.{"+$.cookie("session")+"}";rt=get(key);break;case"app.weibo.getBindingStatus":if(type=="sina"){var key="app.weibo.bindingStatus.{"+$.cookie("session")+"}.sina";var sinaBinding=get(key);if(sinaBinding){rt=sinaBinding.sina_bindingStatus}}if(type=="qqspace"){var key="app.weibo.bindingStatus.{"+$.cookie("session")+"}.qqspace";var qqBinding=get(key);if(qqBinding){rt=qqBinding.qq_bindingStatus}}break;case"com.dbank.signin.issign":var key="com.dbank.signin.issign.{"+$.cookie("session")+"}";rt=get(key);break;case"com.dbank.message.countunread":var key="com.dbank.message.countunread.{"+$.cookie("session")+"}";rt=get(key);break;default:break}return rt}catch(e){}};var putCache=function(data,nsp_svc,type){try{switch(nsp_svc){case"nsp.user.getInfo":var productinfoJson={};var userinfoJson={};var profileinfoJson={};productinfoJson.fileuploadsize=data["product.fileuploadsize"];productinfoJson.spacecapacity=data["product.spacecapacity"];productinfoJson.spaceextcapacity=data["product.spaceextcapacity"];productinfoJson.productname=data["product.productname"];productinfoJson.linkfilesize=data["product.linkfilesize"];productinfoJson["package"]=data["product.package"];productinfoJson.tryvip68=data["product.tryvip68"];productinfoJson.tryvip990=data["product.tryvip990"];productinfoJson.medal=data["product.medal"];var key="nsp.user.product.{"+$.cookie("session")+"}";put(key,productinfoJson);userinfoJson.status=data["user.status"];userinfoJson.username=data["user.username"];userinfoJson.email=data["user.email"];userinfoJson.uid=data["user.uid"];userinfoJson.signin_vip=data["user.signin_vip"];var key="nsp.user.user.{"+$.cookie("session")+"}";put(key,userinfoJson);profileinfoJson.spaceextcapacity=data["profile.spaceextcapacity"];profileinfoJson.usedspacecapacity=data["profile.usedspacecapacity"];profileinfoJson.orderenddate=data["profile.orderenddate"];profileinfoJson.productid=data["profile.productid"];profileinfoJson.extra_apps=data["profile.extra_apps"];profileinfoJson.dbank_skin=data["profile.dbank_skin"];profileinfoJson.dbank_avatar_type=data["profile.dbank_avatar_type"];profileinfoJson.dbank_avatar=data["profile.dbank_avatar"];profileinfoJson.last_login_ip=data["profile.last_login_ip"];profileinfoJson.dbank_outlink=data["profile.dbank_outlink"];profileinfoJson.dbank_netdisk=data["profile.dbank_netdisk"];profileinfoJson.dbank_outlink_file=data["profile.dbank_outlink_file"];profileinfoJson.login_setter_status=data["profile.login_setter_status"];profileinfoJson.paycapacity=data["profile.paycapacity"];profileinfoJson.interval=data["profile.interval"];profileinfoJson.card_type=data["profile.card_type"];profileinfoJson.link_access_switch=data["profile.link_access_switch"];profileinfoJson.dlink_white_list=data["profile.dlink_white_list"];profileinfoJson.dlink_switch=data["profile.dlink_switch"];profileinfoJson.pwd_switch=data["profile.pwd_switch"];profileinfoJson.direct_switch=data["profile.direct_switch"];var pluginStr="";if(data["plugin.dl"]!=null){for(var i=0;i<data["plugin.dl"].length;i++){pluginStr=pluginStr+data["plugin.dl"][i]+","}pluginStr=pluginStr.substring(0,pluginStr.length-1)}else{pluginStr=null}profileinfoJson.plugindl=pluginStr;pluginStr="";if(data["plugin.netdisk"]!=null){for(var i=0;i<data["plugin.netdisk"].length;i++){pluginStr=pluginStr+data["plugin.netdisk"][i]+","}pluginStr=pluginStr.substring(0,pluginStr.length-1)}else{pluginStr=null}profileinfoJson.pluginnetdisk=pluginStr;var key="nsp.user.profile.{"+$.cookie("session")+"}";put(key,profileinfoJson);break;case"nsp.user.getAccounts":var key="nsp.user.account.{"+$.cookie("session")+"}";put(key,data[0].account);break;case"com.dbank.business.getbalance":var key="dbank.business.balance.{"+$.cookie("session")+"}";put(key,data);break;case"app.weibo.getBindingStatus":if(type=="sina"){var key="app.weibo.bindingStatus.{"+$.cookie("session")+"}.sina";var sinaBindingJson={};sinaBindingJson.sina_bindingStatus=data;put(key,sinaBindingJson)}if(type=="qqspace"){var key="app.weibo.bindingStatus.{"+$.cookie("session")+"}.qqspace";var qqBindingJson={};qqBindingJson.qq_bindingStatus=data;put(key,qqBindingJson)}break;case"com.dbank.signin.issign":var key="com.dbank.signin.issign.{"+$.cookie("session")+"}";put(key,data);break;case"com.dbank.message.countunread":var key="com.dbank.message.countunread.{"+$.cookie("session")+"}";put(key,data);break;default:break}}catch(e){}};var updateCache=function(key,data){try{switch(key){case"nsp.user.product.{"+$.cookie("session")+"}":var productinfoJson=get(key);for(var k in data){if(productinfoJson[k]!=undefined){productinfoJson[k]=data[k]}}put(key,productinfoJson);break;case"nsp.user.user.{"+$.cookie("session")+"}":var userinfoJson=get(key);for(var k in data){if(userinfoJson[k]!==undefined){userinfoJson[k]=data[k]}}put(key,userinfoJson);break;case"nsp.user.profile.{"+$.cookie("session")+"}":var profileinfoJson=get(key);for(var k in data){if(profileinfoJson[k]!=undefined){profileinfoJson[k]=data[k]}}put(key,profileinfoJson);break;case"nsp.user.account.{"+$.cookie("session")+"}":put(key,data);break;case"dbank.business.balance.{"+$.cookie("session")+"}":var balanceJson={};balanceJson.balance=data;put(key,balanceJson);break;case"app.weibo.bindingStatus.{"+$.cookie("session")+"}.sina":var sinaBindingJson={};sinaBindingJson.sina_bindingStatus=data;put(key,sinaBindingJson);break;case"app.weibo.bindingStatus.{"+$.cookie("session")+"}.qqspace":var qqBindingJson={};qqBindingJson.qq_bindingStatus=data;put(key,qqBindingJson);break;case"com.dbank.signin.issign.{"+$.cookie("session")+"}":var issignJson={};issignJson.retcode=data;if(data=="0001"){issignJson.retdesc="用户已签到 "}put(key,issignJson);break;case"com.dbank.message.countunread.{"+$.cookie("session")+"}":var countunread={};countunread.count=data;put(key,countunread);break;case"client":var config=getConfigInfo(key);var client=getcommon(config.sharedobject,key);if(client==null){putcommon(config.sharedobject,key,$.cookie("client"))}break;case"secretFlash":var config=getConfigInfo(key);var secretFlash=getcommon(config.sharedobject,key);if(secretFlash==null&&$.cookie("secret")){putcommon(config.sharedobject,key,$.cookie("secret"))}break;case"secretNotflash":var config=getConfigInfo(key);var secretNotflash=get(key);if(secretNotflash==null&&$.cookie("secret")){put(key,$.cookie("secret"))}break;default:break}}catch(e){}};var removeCache=function(key){try{for(var i=0;i<key.length;i++){del(key[i])}}catch(e){}};var clearCache=function(type){try{if(type=="flash"){dbank.cache.flashclear()}else{del("www.dbank.com.rec.editor");var cacheKey="www.dbank.com.rec.extlink,www.dbank.com.rec.weibolink";dbank.cache.xdrRemove(cacheKey,"http://dl.dbank.com");setTimeout("dbank.cache.xdrRemove('www.dbank.com.rec.securelink','http://s.dbank.com')",5000)}}catch(e){}};var checkCacheStatus=function(svc,type){try{var cacheUser;var cache=false;var tag=null;switch(svc){case"nsp.user.getInfo":cache=dbank.config.cache.getInfo.cache;tag=dbank.config.cache.getInfo.tag;break;case"nsp.user.getAccounts":cache=dbank.config.cache.getAccounts.cache;tag=dbank.config.cache.getAccounts.tag;break;case"com.dbank.business.getbalance":cache=dbank.config.cache.getbalance.cache;tag=dbank.config.cache.getbalance.tag;break;case"app.weibo.getBindingStatus":if(type=="sina"){cache=dbank.config.cache.getBindingStatusSina.cache;tag=dbank.config.cache.getBindingStatusSina.tag}if(type=="qqspace"){cache=dbank.config.cache.getBindingStatusQqspace.cache;tag=dbank.config.cache.getBindingStatusQqspace.tag}break;case"www.dbank.com.rec.editor":cache=dbank.config.cache.recEditor.cache;tag=dbank.config.cache.recEditor.tag;break;case"www.dbank.com.rec.weibolink":cache=dbank.config.cache.recWeibolink.cache;tag=dbank.config.cache.recWeibolink.tag;break;case"www.dbank.com.rec.securelink":cache=dbank.config.cache.recSecurelink.cache;tag=dbank.config.cache.recSecurelink.tag;break;case"com.dbank.signin.issign":cache=dbank.config.cache.getIssign.cache;tag=dbank.config.cache.getIssign.tag;break;case"com.dbank.message.countunread":cache=dbank.config.cache.getCountunread.cache;tag=dbank.config.cache.getCountunread.tag;break;case"client":cache=dbank.config.cache.client.cache;tag=dbank.config.cache.client.tag;break;case"secretFlash":cache=dbank.config.cache.secretFlash.cache;tag=dbank.config.cache.secretFlash.tag;break;case"secretNotflash":cache=dbank.config.cache.secretNotflash.cache;tag=dbank.config.cache.secretNotflash.tag;break;default:break}if($.cookie("db_cache")=="true"){cacheUser=true}else{cacheUser=false}if(cacheUser){if(cache==undefined){if(tag=="dynamic"){cache=dbank.config.cache.cacheDynamic}if(tag=="static"){cache=dbank.config.cache.cacheStatic}}}else{cache=false}return cache}catch(e){}};var loginCacheOper=function(){Rookie(function(){if($.cookie("db_cache")=="true"){dbank.cache.flashclear()}if(dbank.config.cache.secretFlash.cache){nsp.netdisk.updateCache("secretFlash")}var config=nsp.netdisk.getConfigInfo("client");var client=nsp.netdisk.getcommon(config.sharedobject,"client");config=nsp.netdisk.getConfigInfo("secretFlash");var secret=nsp.netdisk.getcommon(config.sharedobject,"secretFlash");if(client==null||secret==null){dbank.cache.flashclearcommon("common")}$.cookie("SID_CACHE",$.cookie("session"),{path:"/",domain:".dbank.com"})},function(){})};nsp.netdisk.str_to_array_files=str_to_array_files;nsp.netdisk.savelinkfiles=savelinkfiles;nsp.netdisk.nsp_invoke=nsp_invoke;nsp.netdisk.publishtoweibofuc=publishtoweibofuc;nsp.netdisk.userinfo=userinfo;nsp.netdisk.diskinfo=diskinfo;nsp.netdisk.lsdir=lsdir;nsp.netdisk.mkdir=mkdir;nsp.netdisk.mkfile=mkfile;nsp.netdisk.rename=rename;nsp.netdisk.rmfile=rmfile;nsp.netdisk.movefile=movefile;nsp.netdisk.copyfile=copyfile;nsp.netdisk.restorefile=restorefile;nsp.netdisk.cache_put=cache_put;nsp.netdisk.path_of=path_of;nsp.netdisk.create_link=create_link;nsp.netdisk.clear_recycle=clear_recycle;nsp.netdisk.createResTemplate=createResTemplate;nsp.netdisk.getResTemplate=getResTemplate;nsp.netdisk.getCache=getCache;nsp.netdisk.putCache=putCache;nsp.netdisk.updateCache=updateCache;nsp.netdisk.removeCache=removeCache;nsp.netdisk.clearCache=clearCache;nsp.netdisk.checkCacheStatus=checkCacheStatus;nsp.netdisk.getConfigInfo=getConfigInfo;nsp.netdisk.get=get;nsp.netdisk.put=put;nsp.netdisk.del=del;nsp.netdisk.getcommon=getcommon;nsp.netdisk.putcommon=putcommon;nsp.netdisk.delcommon=delcommon;nsp.netdisk.loginCacheOper=loginCacheOper})();if($.cookie("session")&&($.cookie("SID_CACHE")!=$.cookie("session"))){if(window.location.host.indexOf("www.dbank.com")==-1){$.ajax({url:"http://www.dbank.com/netdisk/skin.php",data:{from:"extlink"},dataType:"jsonp",jsonp:"nsp_cb",timeout:30000,success:function(a){nsp.netdisk.loginCacheOper()},pageCache:true,error:function(){}})}else{if(typeof XMLHttpRequest!="undefined"){xmlHttp=new XMLHttpRequest()}else{if(window.ActiveXObject){var aVersions=["Msxml2.XMLHttp.5.0","Msxml2.XMLHttp.4.0","Msxml2.XMLHttp.3.0","Msxml2.XMLHttp","Microsoft.XMLHttp"];for(var i=0;i<aVersions.length;i++){try{xmlHttp=new ActiveXObject(aVersions[i]);break}catch(e){}}}}xmlHttp.open("GET","http://www.dbank.com/netdisk/skin.php",true);xmlHttp.send(null);xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){nsp.netdisk.loginCacheOper()}}}}if(!dbank){dbank={}}(function(){var a=function(){var r;r=document.getElementById("loginSource").value;$("#msg").hide();$("#checkformtip").hide();if(r=="overtimeLoginTmplData"){$(window.parent.document).find("#overtime_tip").hide()}if(!f()||!l()){return false}var o="client";if(dbank.config.cache.client.cache){Rookie(function(){var v=nsp.netdisk.getConfigInfo(o);var u=nsp.netdisk.getcommon(v.sharedobject,o);if(u!=null){document.getElementById("nsp_cid").value=u}else{nsp.netdisk.putcommon(v.sharedobject,o,document.getElementById("nsp_cid").value)}},function(){})}var p=document.getElementById("nonce").value;var t=document.getElementById("nsp_user").value;var q=document.getElementById("pass").value;var m=":NSP Passport:";var n="";n=Crypto.MD5(t+m+q);var o=Crypto.MD5(n+":"+p);var s={response:o,m:1,nsp_cid:document.getElementById("nsp_cid").value,a_ids:document.getElementById("a_ids").value,nsp_user:document.getElementById("nsp_user").value,nonce:document.getElementById("nonce").value};$.ajax({url:"http://login.dbank.com/loginauth.php?nsp_app=48049",type:"post",data:s,dataType:"json",timeout:30000,success:function(w){if(w.retcode==0&&w.k){var x="";if(document.getElementById("rememberme").checked==true){x="&rememberme=true"}if(r=="overtimeLoginTmplData"){parent.parent.location.href="http://login.dbank.com/loginauth.php?k="+w.k+x+"&ru="+parent.document.referrer}else{if(r=="indexLoginTmplData"){parent.location.href="http://login.dbank.com/loginauth.php?k="+w.k+x+"&ru=http://www.dbank.com/ServiceLogin.action"}else{if(r=="extlinkLoginTmplData"){parent.location.href="http://login.dbank.com/loginauth.php?k="+w.k+x+"&ru="+$.cookie("extlinkurl")}}}}if(w.retcode==1){$("#msg").html(w.message).css("left",$("#nsp_user_box").offset().left).show()}if(w.retcode==2){$("#msg").html(w.message).css("left",$("#nsp_user_box").offset().left).show();$("#submit_btn").attr("disabled","disabled").addClass("btn-login-unbind");$("#login").unbind("keyup");var v=parseInt(w.second,10)-1;var u=setInterval(function(){if(v<0){clearInterval(u);$("#msg").hide();$("#submit_btn").removeAttr("disabled").removeClass("btn-login-unbind");$("#login").bind("keyup",function(y){if(y.keyCode=="13"){return a()}});return}$("#msg").html("请勿频繁登录，"+v+"秒后重试");v--},1000)}},error:function(u,w,v){}});return true};var g=function(t,p,s){p=decodeURIComponent(p);var o="";var m="";function n(v,w){var u;if(Boolean(w.match(/^[0-9]+$/))&&m.constructor==Array){u=m[parseInt(w)]}else{u=m[w]}return u?u:""}function r(u,v){m=v;return u.replace(/\$\{?([A-Za-z_0-9]+)\}?/g,n)}var q=r(p,s);o+=q;document.getElementById(t).innerHTML=o;document.getElementById(t).style.display="block"};var d=function(s,r,n,q){var m=$.trim,r=m(r);s.unbind();if(q&&typeof q=="object"){for(var p in q){s.bind(p,q[p])}}if(!r){return}s.focus(function(){if(!n){if(m(s.val())==r){s.val("")}}else{s.removeClass(r)}}).blur(function(){if(m(s.val())==""){if(!n){s.css("color","#999").val(r)}else{s.addClass(r)}}});if(!n){s.keyup(function(){var o=s.css("color","#000").val();if((o=m(o)).indexOf(r)>=0){s.val(o)}})}return{setNormal:function(o){if(o||typeof(o)=="string"){s.css("color","#000").val(o)}if(m(s.val())==""){if(!n){s.css("color","#999").val(r)}else{s.addClass(r)}}}}};var h=function(){var o;o=document.getElementById("loginSource").value;if($.cookie("k")){var n;n=encodeURIComponent($.cookie("k"));if(o=="overtimeLoginTmplData"){parent.parent.location.href="http://login.dbank.com/loginauth.php?k="+n+"&ru="+parent.document.referrer}else{if(o=="indexLoginTmplData"){parent.location.href="http://login.dbank.com/loginauth.php?k="+n+"&ru=http://www.dbank.com/ServiceLogin.action"}else{if(o=="extlinkLoginTmplData"){parent.location.href="http://login.dbank.com/loginauth.php?k="+n+"&ru="+$.cookie("extlinkurl")}}}}g("loginFormElem",document.getElementById("loginform_tpl").value,dbank.login.tmpldata);document.getElementById("login").style.display="block";if(o=="indexLoginTmplData"||o=="overtimeLoginTmplData"){if(o=="overtimeLoginTmplData"){var p=parent.window.location.href;p.replace(/&preurl=([a-zA-Z_0-9\?\.\/\=:#%\(\)\,\-\u4e00-\u9fa5]+)&/,function(r,t){var s=new RegExp("http://www.dbank.com/netdisk/netdisk_setting.html#");var q=p.match(/http:\/\/www.dbank.com\/netdisk\/outlink.html[\?\=\.\w]+#[1-3]/gi);if(s.test(p)||q!=null){locurl=t.split("#")[0]+"#"+t.split("#")[1];m=locurl;preurl_qq=t.split("#")[0]}else{if(p==t){m="http://www.dbank.com";preurl_qq="http://www.dbank.com"}else{locurl=t.split("#")[0];m=locurl;preurl_qq=locurl}}})}else{var m="http://www.dbank.com/netdisk/api.php?action=changeDisk"}$.ajax({type:"get",url:"http://www.dbank.com/app/web/weibo.php",dataType:"jsonp",data:{action:"getLoginUrl",_atc_:Math.floor(Math.random()*1000),ru:m},success:function(s){var q=null;var r="client";if(dbank.config.cache.client.cache){Rookie(function(){var v=nsp.netdisk.getConfigInfo(r);var u=nsp.netdisk.getcommon(v.sharedobject,r);if(u!=null){var w=s.split("?");q=w[0]+"?client="+u+"&"+w[1];j(q)}else{j(s)}v=nsp.netdisk.getConfigInfo("secretFlash");var t=nsp.netdisk.getcommon(v.sharedobject,"secretFlash");if(t!=null){$.cookie("secret",t,{path:"/",domain:".dbank.com"})}},function(){j(s)})}else{j(s)}}});$.ajax({type:"get",url:"http://www.dbank.com/app/web/weibo.php",dataType:"jsonp",data:{action:"getLoginUrl",_atc_:Math.floor(Math.random()*1000),oauth_type:"qqspace",ru:"http://www.dbank.com/netdisk/close.html"},success:function(v){var q=null;var r="client";if(dbank.config.cache.client.cache){Rookie(function(){var y=nsp.netdisk.getConfigInfo(r);var x=nsp.netdisk.getcommon(y.sharedobject,r);if(x!=null){var z=v.split("%3F");q=z[0]+"%3Fclient%3D"+x+"%26"+z[1]}y=nsp.netdisk.getConfigInfo("secretFlash");var w=nsp.netdisk.getcommon(y.sharedobject,"secretFlash");if(w!=null){$.cookie("secret",w,{path:"/",domain:".dbank.com"})}},function(){q=null})}var t;function s(w){if(w!=null){t=window.open(w,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=1")}else{t=window.open(v,"TencentLogin","width=450,height=320,menubar=0,scrollbars=1, resizable=1,status=1,titlebar=0,toolbar=0,location=1")}}function u(){t.close()}$("#qq_login_link").bind("click",function(){if(o=="indexLoginTmplData"){_gaq.push(["_trackEvent","HyperLink","Click","QQLogin"])}s(q);$(window).focus(function(){if(o=="indexLoginTmplData"){top.location.href="http://www.dbank.com"}else{if(o=="overtimeLoginTmplData"){parent.parent.location.href=parent.document.referrer}}});return false});$("#qqLoginTip").bind("click",function(){s(q);$(window).focus(function(){if(o=="overtimeLoginTmplData"){parent.parent.location.href=parent.document.referrer}});return false})}})}if($("#msg").html()){$("#msg").css("left",$("#nsp_user_box").offset().left).show()}d($("#nsp_user"),"邮箱/手机号").setNormal();d($("#pass"),"pwd_bg",true).setNormal();$("#login").bind("keyup",function(q){if(q.keyCode=="13"){return a()}});if(o=="indexLoginTmplData"){$("#sina_login_link").bind("click",function(){_gaq.push(["_trackEvent","HyperLink","Click","WeiboLogin"])});$("#submit_btn").bind("click",function(){_gaq.push(["_trackEvent","Buttons","Click","LoginButton"])});$("#rememberme").bind("click",function(){_gaq.push(["_trackEvent","Checkbox","Choose","RememberLogin"])});$("#nsp_user").bind("focus",function(){_gaq.push(["_trackEvent","Texts","Focus","LoginAccount"])});$("#pass").bind("focus",function(){_gaq.push(["_trackEvent","Texts","Focus","LoginPassword"])});$("#forgetPasswordTip").bind("click",function(){_gaq.push(["_trackEvent","HyperLink","Click","ForgetPassword"])})}};var j=function(m){var n;n=document.getElementById("loginSource").value;$("#sina_login_link").bind("click",function(){if(n=="indexLoginTmplData"){parent.location.href=m}else{if(n=="overtimeLoginTmplData"){parent.parent.location.href=m}}});$("#sinaLoginTip").bind("click",function(){if(n=="overtimeLoginTmplData"){parent.parent.location.href=m}})};var f=function(){var n;n=document.getElementById("loginSource").value;var m=b(document.getElementById("nsp_user").value);if(!m||m=="邮箱/手机号"){if(n=="indexLoginTmplData"){$("#checkformtip").css("left",$("#nsp_user_box").offset().left-$("#loginFormElem").offset().left)}$("#checkformtip").text("帐号不能为空").show();return false}else{if(m.length>=1){if(!c(m)){if(n=="indexLoginTmplData"){$("#checkformtip").css("left",$("#nsp_user_box").offset().left-$("#loginFormElem").offset().left)}$("#checkformtip").text("邮箱或手机号格式不正确").show();return false}}}return true};var l=function(){var n=document.getElementById("pass").value;var m;m=document.getElementById("loginSource").value;if(!n){if(m=="indexLoginTmplData"){$("#checkformtip").css("left",$("#pass_box").offset().left-$("#loginFormElem").offset().left)}$("#checkformtip").text("密码不能为空").show();return false}else{if(n.length<6||n.length>32){if(m=="indexLoginTmplData"){$("#checkformtip").css("left",$("#nsp_user_box").offset().left-$("#loginFormElem").offset().left)}$("#checkformtip").text("帐号或密码不正确，请重新输入").show();return false}}return true};var c=function(p){if(p.length>100||p.length==0){return false}if(p.indexOf("'")!=-1||p.indexOf("/")!=-1||p.indexOf("\\")!=-1||p.indexOf("<")!=-1||p.indexOf(">")!=-1){return false}if(p.indexOf(" ")>-1||p.indexOf("　")>-1){return false}var m="^([a-z0-9_\\.-]+)@([\\da-z\\.-]+)\\.([a-z\\.]{2,6})$";var o=new RegExp(m,"i");p=p.replace("；",";");p=p.replace("<","");p=p.replace(">","");p=p.replace("(","");p=p.replace(")","");p=p.replace("（","");p=p.replace("）","");var r=p.split(";");var q=0;var t=true;while(q<r.length){if(r[q].search(o)==-1){t=false}q+=1}if(!t){var n=new RegExp("^((\\+{0,1}86){0,1})1[0-9]{10}$");return n.test(p)}else{return t}};var b=function(m){return m.replace(/^\s+|\s+$/i,"")};h();window.beforeLoginSubmit=a})();